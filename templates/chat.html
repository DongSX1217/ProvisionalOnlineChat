<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€æ˜“åœ¨çº¿èŠå¤©å®¤</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/markdown.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ç®€æ˜“ä¸´æ—¶åœ¨çº¿èŠå¤©å®¤</h1>
            <div class="header-buttons">
                <button class="markdown-help-btn" id="markdownHelpBtn">MDå¸®åŠ©</button>
                <!-- <button class="highlight-btn" id="highlightBtn">â­ ç²¾å</button> -->
                <button class="notification-btn" id="notificationBtn">ğŸ”” é€šçŸ¥</button>
            </div>
        </header>
        
        <div class="info-bar">
            {{ info_bar_content | safe }}
        </div>
        
        <div class="chat-container" id="chatContainer">
            <div class="typing-indicator" id="typingIndicator"></div>
            <div id="scrollAnchor"></div>
        </div>
        
        <div class="error-message" id="errorMessage"></div>
        
        <div class="input-area">
            <div class="input-group">
                <input type="text" id="username" placeholder="è¾“å…¥æ‚¨çš„ç”¨æˆ·å" maxlength="20">
            </div>
            
            <div class="message-input">
                <textarea id="message" placeholder="è¾“å…¥æ¶ˆæ¯å†…å®¹... æ”¯æŒMarkdownæ ¼å¼ï¼Œå¯ä»¥æ¢è¡Œï¼ŒæŒ‰Shift+Enterå‘é€æ¶ˆæ¯"></textarea>
            </div>
            
            <div class="emoji-container" id="emojiContainer"></div>
            
            <div class="image-preview" id="imagePreview">
                <img id="previewImage" src="" alt="å›¾ç‰‡é¢„è§ˆ">
                <div class="remove-image" id="removeImage">ç§»é™¤å›¾ç‰‡</div>
            </div>
            
            <div class="buttons">
                <button class="emoji-btn" id="emojiBtn">è¡¨æƒ…</button>
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button class="image-btn" id="imageBtn">å›¾ç‰‡</button>
                <button class="send-btn" id="sendBtn">å‘é€</button>
            </div>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    <div class="markdown-help" id="markdownHelp">
        <button class="markdown-help-close" id="markdownHelpClose">&times;</button>
        <h2>Markdownè¯­æ³•å¸®åŠ©</h2>
        <p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹Markdownè¯­æ³•æ ¼å¼åŒ–æ‚¨çš„æ¶ˆæ¯ï¼š</p>
        
        <table>
            <tr>
                <th>æ•ˆæœ</th>
                <th>è¯­æ³•</th>
                <th>ç¤ºä¾‹</th>
            </tr>
            <tr>
                <td><strong>åŠ ç²—</strong></td>
                <td>**æ–‡æœ¬** æˆ– __æ–‡æœ¬__</td>
                <td>**é‡è¦** â†’ <strong>é‡è¦</strong></td>
            </tr>
            <tr>
                <td><em>æ–œä½“</em></td>
                <td>*æ–‡æœ¬* æˆ– _æ–‡æœ¬_</td>
                <td>*æ–œä½“* â†’ <em>æ–œä½“</em></td>
            </tr>
            <tr>
                <td><del>åˆ é™¤çº¿</del></td>
                <td>~~æ–‡æœ¬~~</td>
                <td>~~åˆ é™¤~~ â†’ <del>åˆ é™¤</del></td>
            </tr>
            <tr>
                <td>æ ‡é¢˜</td>
                <td># ä¸€çº§æ ‡é¢˜<br>## äºŒçº§æ ‡é¢˜</td>
                <td>## æ ‡é¢˜ â†’ <h2 style="margin:0;font-size:1.2rem;">æ ‡é¢˜</h2></td>
            </tr>
            <tr>
                <td>é“¾æ¥</td>
                <td>[æ–‡æœ¬](URL)</td>
                <td>[ç™¾åº¦](https://baidu.com) â†’ <a href="https://baidu.com">ç™¾åº¦</a></td>
            </tr>
            <tr>
                <td>å›¾ç‰‡</td>
                <td>![æè¿°](URL)</td>
                <td>![å›¾ç‰‡](https://example.com/image.jpg)</td>
            </tr>
            <tr>
                <td>ä»£ç </td>
                <td>`ä»£ç `</td>
                <td>`print("Hello")` â†’ <code>print("Hello")</code></td>
            </tr>
            <tr>
                <td>ä»£ç å—</td>
                <td>```è¯­è¨€<br>ä»£ç <br>```</td>
                <td>```python<br>print("Hello")<br>``` â†’ <pre><code>print("Hello")</code></pre></td>
            </tr>
            <tr>
                <td>å¼•ç”¨</td>
                <td>&gt; å¼•ç”¨æ–‡æœ¬</td>
                <td>&gt; å¼•ç”¨ â†’ <blockquote style="margin:0;padding-left:10px;border-left:3px solid #ccc;">å¼•ç”¨</blockquote></td>
            </tr>
            <tr>
                <td>åˆ—è¡¨</td>
                <td>- é¡¹ç›®1<br>- é¡¹ç›®2</td>
                <td>- é¡¹ç›® â†’ <ul style="margin:0;"><li>é¡¹ç›®</li></ul></td>
            </tr>
            <tr>
                <td>è¡¨æ ¼</td>
                <td>| æ ‡é¢˜1 | æ ‡é¢˜2 |<br>|-------|-------|<br>| å†…å®¹1 | å†…å®¹2 |</td>
                <td>| A | B |<br>|---|---|<br>| 1 | 2 | â†’ <table style="margin:0;"><tr><th>A</th><th>B</th></tr><tr><td>1</td><td>2</td></tr></table></td>
            </tr>
        </table>
    </div>

    <!-- Markdownæºç å¼¹çª— -->
    <div class="source-modal">
        <button class="close-btn">&times;</button>
        <h2>Markdown æºä»£ç </h2>
        <div class="source-content"></div>
    </div>

    <script src="/static/js/marked.min.js"></script>
    <script src="/static/js/purify.min.js"></script>
    <script src="/static/js/script.js"></script>
    <script>
        // å‘é€æ¶ˆæ¯åä¿å­˜ç”¨æˆ·ååˆ°cookie
        function saveUsernameToCookie() {
            const usernameInput = document.querySelector('#username');
            if (usernameInput) {
                const username = usernameInput.value.trim();
                // å¦‚æœç”¨æˆ·åä¸ä¸ºç©ºä¸”ä¸æ˜¯åŒ¿åï¼Œåˆ™ä¿å­˜åˆ°cookie
                if (username && username !== 'åŒ¿å') {
                    // ä¿å­˜ç”¨æˆ·ååˆ°cookieï¼Œæœ‰æ•ˆæœŸ30å¤©
                    document.cookie = `username=${encodeURIComponent(username)}; max-age=${60*60*24*30}; path=/`;
                }
            }
        }

        // åœ¨å‘é€æ¶ˆæ¯æŒ‰é’®çš„äº‹ä»¶ç›‘å¬ä¸­è°ƒç”¨ä¿å­˜ç”¨æˆ·åå‡½æ•°
        document.addEventListener('DOMContentLoaded', function() {
            const sendBtn = document.querySelector('#sendBtn');
            if (sendBtn) {
                sendBtn.addEventListener('click', function() {
                    saveUsernameToCookie();
                });
            }
        });
    </script>
</body>
</html>